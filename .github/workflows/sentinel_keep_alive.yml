name: Sentinel (Keep Alive & Monitor)

on:
  schedule:
    - cron: "0 0 * * *"   # Run every 24 hours
  workflow_dispatch:      # Allow manual run

jobs:
  wake-up-check:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          # --- APP 1 ---
          - name: "App 1: SwingScan"
            url: "https://taraacademy-swingscan.hf.space"
            
          # --- APP 2 ---
          - name: "App 2: US Market Analytics"
            url: "https://taraacademy-us-market-scanner.hf.space"
            
          # --- APP 3 ---
          - name: "App 3: Dashboard"
            url: "https://taraacademy-super-scanner.hf.space"

          # --- APP 4 ---
          - name: "App 4: Pre-Market Scanner"
            url: "https://taraacademy-premarketscanner.hf.space"

          # --- APP 5 ---
          - name: "App 5: SwingLab Pro Next"
            url: "https://taraacademy-swinglabpronext.hf.space"

    steps:
      - name: Sentinel Check for ${{ matrix.name }}
        run: |
          echo "Target: ${{ matrix.url }}"
          
          # Try to wake up the space
          response=$(curl -s -o /dev/null -w "%{http_code}" ${{ matrix.url }})
          
          if [ "$response" -eq 200 ]; then
            echo "✅ ${{ matrix.name }} is AWAKE and Running (Status: 200)"
          elif [ "$response" -eq 503 ]; then
            echo "⚠️ ${{ matrix.name }} is STARTING UP or BUILDING (Status: 503)"
            # Wait 30 seconds and try one more time
            sleep 30
            retry=$(curl -s -o /dev/null -w "%{http_code}" ${{ matrix.url }})
            echo "   ↳ Retry Status: $retry"
          else
            echo "❌ ${{ matrix.name }} returned unexpected status: $response"
            exit 1
          fi
